{% extends "layout.html" %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="mb-4">Settings</h1>
        <p class="lead">Customize your eye health monitoring experience.</p>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-bell"></i> Notifications
            </div>
            <div class="card-body">
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="drowsinessAlerts" checked>
                        <label class="form-check-label" for="drowsinessAlerts">Drowsiness Alerts</label>
                    </div>
                    <small class="text-muted">Get alerts when signs of drowsiness are detected</small>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="blinkRateAlerts" checked>
                        <label class="form-check-label" for="blinkRateAlerts">Blink Rate Reminders</label>
                    </div>
                    <small class="text-muted">Remind me to blink more when my blink rate is low</small>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="breakReminders" checked>
                        <label class="form-check-label" for="breakReminders">Break Reminders</label>
                    </div>
                    <small class="text-muted">Remind me to take breaks based on the 20-20-20 rule</small>
                </div>
                
                <div class="settings-option">
                    <label for="breakInterval" class="form-label">Break Reminder Interval</label>
                    <select class="form-select" id="breakInterval" onchange="updateReminderInterval()">
                        <option value="15">Every 15 minutes</option>
                        <option value="20" selected>Every 20 minutes</option>
                        <option value="30">Every 30 minutes</option>
                        <option value="45">Every 45 minutes</option>
                        <option value="60">Every 60 minutes</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <i class="bi bi-moon"></i> Appearance
            </div>
            <div class="card-body">
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="darkModeToggle">
                        <label class="form-check-label" for="darkModeToggle">Dark Mode</label>
                    </div>
                    <small class="text-muted">Switch to dark color scheme</small>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="highContrastMode">
                        <label class="form-check-label" for="highContrastMode">High Contrast Mode</label>
                    </div>
                    <small class="text-muted">Increase text contrast for better readability</small>
                </div>
                
                <div class="settings-option">
                    <label for="textSize" class="form-label">Text Size</label>
                    <select class="form-select" id="textSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                        <option value="x-large">Extra Large</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-eye"></i> Eye Tracking
            </div>
            <div class="card-body">
                <div class="settings-option">
                    <label for="eyeDetectionSensitivity" class="form-label">Eye Detection Sensitivity</label>
                    <input type="range" class="form-range" min="1" max="10" value="5" id="eyeDetectionSensitivity">
                    <div class="d-flex justify-content-between">
                        <small>Low</small>
                        <small>High</small>
                    </div>
                </div>
                
                <div class="settings-option">
                    <label for="drowsinessThreshold" class="form-label">Drowsiness Alert Threshold</label>
                    <input type="range" class="form-range" min="40" max="80" value="60" id="drowsinessThreshold">
                    <div class="d-flex justify-content-between">
                        <small>Early (40%)</small>
                        <small>Late (80%)</small>
                    </div>
                </div>
                
                <div class="settings-option">
                    <label for="minHealthyBlinkRate" class="form-label">Minimum Healthy Blink Rate</label>
                    <input type="number" class="form-control" id="minHealthyBlinkRate" value="15" min="10" max="25">
                    <small class="text-muted">Blinks per minute below this value trigger alerts</small>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="useInfraredMode">
                        <label class="form-check-label" for="useInfraredMode">Use Infrared Detection (if available)</label>
                    </div>
                    <small class="text-muted">Better detection in low light conditions</small>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <i class="bi bi-hand-index"></i> Accessibility
            </div>
            <div class="card-body">
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="gazeControl">
                        <label class="form-check-label" for="gazeControl">Gaze Control</label>
                    </div>
                    <small class="text-muted">Control device with eye movements</small>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="blinkControl">
                        <label class="form-check-label" for="blinkControl">Blink Control</label>
                    </div>
                    <small class="text-muted">Use double blinks as click actions</small>
                </div>
                
                <div class="settings-option">
                    <label for="gazeSensitivity" class="form-label">Gaze Control Sensitivity</label>
                    <input type="range" class="form-range" min="1" max="10" value="5" id="gazeSensitivity">
                    <div class="d-flex justify-content-between">
                        <small>Low</small>
                        <small>High</small>
                    </div>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="voiceFeedback">
                        <label class="form-check-label" for="voiceFeedback">Voice Feedback</label>
                    </div>
                    <small class="text-muted">Provide audio feedback for eye health alerts</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-database"></i> Data & Privacy
            </div>
            <div class="card-body">
                <div class="settings-option">
                    <label for="dataRetention" class="form-label">Data Retention Period</label>
                    <select class="form-select" id="dataRetention">
                        <option value="7">7 days</option>
                        <option value="30" selected>30 days</option>
                        <option value="90">90 days</option>
                        <option value="365">1 year</option>
                        <option value="0">Keep indefinitely</option>
                    </select>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="allowAnalytics" checked>
                        <label class="form-check-label" for="allowAnalytics">Share Anonymous Statistics</label>
                    </div>
                    <small class="text-muted">Help improve the app by sharing anonymous usage data</small>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="cloudBackup">
                        <label class="form-check-label" for="cloudBackup">Cloud Backup</label>
                    </div>
                    <small class="text-muted">Back up your eye health data to the cloud</small>
                </div>
                
                <div class="settings-option">
                    <button class="btn btn-outline-danger btn-sm">
                        <i class="bi bi-trash"></i> Delete All Data
                    </button>
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-download"></i> Export Data
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-camera"></i> Camera
            </div>
            <div class="card-body">
                <div class="settings-option">
                    <label for="cameraSelection" class="form-label">Camera Selection</label>
                    <select class="form-select" id="cameraSelection">
                        <option value="front" selected>Front Camera</option>
                        <option value="back">Back Camera</option>
                        <option value="external">External Camera (if connected)</option>
                    </select>
                </div>
                
                <div class="settings-option">
                    <label for="cameraResolution" class="form-label">Camera Resolution</label>
                    <select class="form-select" id="cameraResolution">
                        <option value="low">Low (saves battery)</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High (better detection)</option>
                    </select>
                </div>
                
                <div class="settings-option">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="saveScreenshots">
                        <label class="form-check-label" for="saveScreenshots">Save Screenshots</label>
                    </div>
                    <small class="text-muted">Save screenshots when drowsiness is detected</small>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <i class="bi bi-info-circle"></i> About
            </div>
            <div class="card-body">
                <p><strong>EyeCare AI</strong> v1.0.0</p>
                <p>© 2025 EyeCare AI</p>
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-question-circle"></i> Help & Support
                    </button>
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-book"></i> User Guide
                    </button>
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-shield-check"></i> Privacy Policy
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12 text-center">
        <button class="btn btn-primary">
            <i class="bi bi-save"></i> Save Settings
        </button>
        <button class="btn btn-outline-secondary">
            <i class="bi bi-arrow-counterclockwise"></i> Reset to Defaults
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Load saved settings
    document.addEventListener('DOMContentLoaded', function() {
        const savedInterval = localStorage.getItem('reminderInterval');
        if (savedInterval) {
            document.getElementById('breakInterval').value = savedInterval;
        }
    });
    
    // Update reminder interval
    function updateReminderInterval() {
        const intervalSelect = document.getElementById('breakInterval');
        const selectedInterval = intervalSelect.value;
        
        localStorage.setItem('reminderInterval', selectedInterval);
        
        // Show confirmation message
        const confirmationMessage = document.createElement('div');
        confirmationMessage.className = 'alert alert-success alert-dismissible fade show mt-2';
        confirmationMessage.innerHTML = `
            <strong>Reminder interval updated!</strong> Break reminders will now appear every ${selectedInterval} minutes.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        const breakIntervalContainer = document.querySelector('.settings-option');
        breakIntervalContainer.appendChild(confirmationMessage);
        
        // Auto-dismiss after 3 seconds
        setTimeout(() => {
            if (confirmationMessage.parentNode) {
                confirmationMessage.remove();
            }
        }, 3000);
        
        console.log(`Reminder interval set to ${selectedInterval} minutes`);
    }
    
    // Handle dark mode toggle
    document.getElementById('darkModeToggle').addEventListener('change', function() {
        if (this.checked) {
            document.body.classList.add('bg-dark', 'text-light');
            document.querySelectorAll('.card').forEach(card => {
                card.classList.add('bg-dark', 'text-light', 'border-secondary');
            });
            document.querySelectorAll('.card-header').forEach(header => {
                header.classList.add('bg-dark', 'text-light', 'border-secondary');
            });
            document.querySelectorAll('.navbar').forEach(nav => {
                nav.classList.remove('navbar-light', 'bg-light');
                nav.classList.add('navbar-dark', 'bg-dark');
            });
            document.querySelectorAll('.settings-option').forEach(option => {
                option.classList.add('border-secondary');
            });
            document.querySelectorAll('.form-control, .form-select').forEach(input => {
                input.classList.add('bg-secondary', 'text-light', 'border-dark');
            });
        } else {
            document.body.classList.remove('bg-dark', 'text-light');
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('bg-dark', 'text-light', 'border-secondary');
            });
            document.querySelectorAll('.card-header').forEach(header => {
                header.classList.remove('bg-dark', 'text-light', 'border-secondary');
            });
            document.querySelectorAll('.navbar').forEach(nav => {
                nav.classList.add('navbar-light', 'bg-light');
                nav.classList.remove('navbar-dark', 'bg-dark');
            });
            document.querySelectorAll('.settings-option').forEach(option => {
                option.classList.remove('border-secondary');
            });
            document.querySelectorAll('.form-control, .form-select').forEach(input => {
                input.classList.remove('bg-secondary', 'text-light', 'border-dark');
            });
        }
    });
    
    // Update range input values
    document.querySelectorAll('input[type="range"]').forEach(range => {
        range.addEventListener('input', function() {
            const valueDisplay = document.createElement('small');
            valueDisplay.classList.add('ms-2', 'badge', 'bg-primary');
            valueDisplay.textContent = this.value;
            
            // Remove existing value display if any
            const existing = this.parentNode.querySelector('.badge');
            if (existing) {
                existing.remove();
            }
            
            // Insert after the input
            this.insertAdjacentElement('afterend', valueDisplay);
        });
        
        // Trigger for initial display
        range.dispatchEvent(new Event('input'));
    });
    
    // Handle save settings
    document.querySelector('.btn-primary').addEventListener('click', function() {
        // In a real app, this would save the settings to a database
        const alert = document.createElement('div');
        alert.classList.add('alert', 'alert-success', 'alert-dismissible', 'fade', 'show', 'position-fixed', 'bottom-0', 'end-0', 'm-3');
        alert.innerHTML = `
            <strong>Success!</strong> Settings saved successfully.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        document.body.appendChild(alert);
        
        // Auto dismiss after 3 seconds
        setTimeout(() => {
            const dismissButton = alert.querySelector('.btn-close');
            if (dismissButton) {
                dismissButton.click();
            }
        }, 3000);
    });
    
    // Handle reset to defaults
    document.querySelector('.btn-outline-secondary').addEventListener('click', function() {
        if (confirm('Are you sure you want to reset all settings to their default values?')) {
            document.querySelectorAll('.form-check-input').forEach(checkbox => {
                if (checkbox.id === 'darkModeToggle' || 
                    checkbox.id === 'highContrastMode' ||
                    checkbox.id === 'useInfraredMode' ||
                    checkbox.id === 'gazeControl' ||
                    checkbox.id === 'blinkControl' ||
                    checkbox.id === 'voiceFeedback' ||
                    checkbox.id === 'saveScreenshots') {
                    checkbox.checked = false;
                } else {
                    checkbox.checked = true;
                }
                
                // Trigger change event for dark mode
                if (checkbox.id === 'darkModeToggle') {
                    checkbox.dispatchEvent(new Event('change'));
                }
            });
            
            document.getElementById('breakInterval').value = '20';
            document.getElementById('textSize').value = 'medium';
            document.getElementById('eyeDetectionSensitivity').value = '5';
            document.getElementById('drowsinessThreshold').value = '60';
            document.getElementById('minHealthyBlinkRate').value = '15';
            document.getElementById('gazeSensitivity').value = '5';
            document.getElementById('dataRetention').value = '30';
            document.getElementById('cameraSelection').value = 'front';
            document.getElementById('cameraResolution').value = 'medium';
            
            // Update range displays
            document.querySelectorAll('input[type="range"]').forEach(range => {
                range.dispatchEvent(new Event('input'));
            });
            
            // Show reset confirmation
            const alert = document.createElement('div');
            alert.classList.add('alert', 'alert-info', 'alert-dismissible', 'fade', 'show', 'position-fixed', 'bottom-0', 'end-0', 'm-3');
            alert.innerHTML = `
                <strong>Reset Complete!</strong> All settings have been restored to their default values.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            document.body.appendChild(alert);
            
            // Auto dismiss after 3 seconds
            setTimeout(() => {
                const dismissButton = alert.querySelector('.btn-close');
                if (dismissButton) {
                    dismissButton.click();
                }
            }, 3000);
        }
    });
</script>
{% endblock %}